version: '3'
services:
  server:
    image: server-image
    deploy:
      replicas: 2
    ports:
      - 8080:8080
    networks:
      - cluster_network

  prometheus:
    image: prom/prometheus
    command: --web.enable-lifecycle  --config.file=/etc/prometheus/prometheus.yml
    volumes:
      - ./prometheus:/etc/prometheus
      - prometheus-data:/prometheus
    networks:
      - cluster_network
    depends_on: 
      - server

    grafana:
      image: grafana/grafana
      depends_on:
        - prometheus
      ports:
        - 3000:3000
      volumes:
        - grafana_data:/var/lib/grafana
        - ./grafana/provisioning/:/etc/grafana/provisioning/
      env_file:
        - ./grafana/config.monitoring
      networks:
        - back-tier
        - front-tier
      restart: always
          networks:
              - cluster_network
          depends_on:
              - prometheus

   
volumes:
    prometheus-data:
    grafana_data:
networks:
    cluster_network: